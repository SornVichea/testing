<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church Management System</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Ensure html and body take full height for min-h-screen to work correctly */
        html, body {
            height: 100%;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for modals if content overflows */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark .modal-content::-webkit-scrollbar-track {
            background: #333;
        }
        .dark .modal-content::-webkit-scrollbar-thumb {
            background: #555;
        }
        .dark .modal-content::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        /* Animation for deleting a member row */
        @keyframes fadeOutDownScale {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
                height: 0; /* Collapse the row height */
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
                border-bottom: none; /* Remove border during collapse */
            }
        }

        .animate-delete-fire {
            animation: fadeOutDownScale 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-indigo-700 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold rounded-md px-2 py-1" id="system-name">NewLife Fellowship</h1>
            <nav>
                <ul class="flex space-x-4 items-center">
                    <li>
                        <a href="#" class="hover:text-indigo-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span id="profile-text">Profile</span>
                        </a>
                    </li>
                    <li>
                        <button id="theme-toggle" class="px-2 py-1 rounded-md hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9 9 0 008.354-5.646z" />
                            </svg>
                        </button>
                    </li>
                    <li>
                        <button id="settings-button" class="px-2 py-1 rounded-md hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <span id="settings-text">Settings</span>
                        </button>
                    </li>
                    <li>
                        <a href="#" class="hover:text-indigo-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                            <span id="logout-text">Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container mx-auto flex flex-col lg:flex-row mt-8 p-4 lg:p-0 flex-grow">
        <!-- Sidebar -->
        <aside class="w-full lg:w-1/4 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 lg:mr-8 mb-8 lg:mb-0">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Navigation</h3>
            <nav>
                <ul>
                    <li class="mb-3">
                        <button id="nav-dashboard" class="w-full text-left px-4 py-2 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l-7 7-7-7m7 7v10a1 1 0 01-1 1h-3" />
                            </svg>
                            <span id="dashboard-nav-text">Dashboard</span>
                        </button>
                    </li>
                    <li class="mb-3">
                        <button id="nav-bible-class" class="w-full text-left px-4 py-2 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5s3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18s-3.332.477-4.5 1.253" />
                            </svg>
                            <span id="bible-class-nav-text">Bible Class</span>
                        </button>
                    </li>
                    <li class="mb-3">
                        <button id="nav-members" class="w-full text-left px-4 py-2 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h2a2 2 0 002-2V7a2 2 0 00-2-2h-2v12m-2 2h-2a2 2 0 01-2-2V7a2 2 0 012-2h2m-6 0H4a2 2 0 00-2 2v10a2 2 0 002 2h2" />
                            </svg>
                            <span id="members-nav-text">Members</span>
                        </button>
                    </li>
                    <li class="mb-3">
                        <button id="nav-events" class="w-full text-left px-4 py-2 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span id="events-nav-text">Events</span>
                        </button>
                    </li>
                    <li class="mb-3">
                        <button id="nav-reports" class="w-full text-left px-4 py-2 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-5m3 5v-8m3 5v-2M9 21h6a2 2 0 002-2V7a2 2 0 00-2-2H9a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span id="reports-nav-text">Reports</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main id="main-content" class="w-full lg:w-3/4 flex-grow">
            <!-- Loading spinner removed as local operations are instant -->

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md text-gray-900 dark:text-gray-100 hidden">
                <h2 class="text-2xl font-semibold mb-4" id="dashboard-overview-title">Dashboard Overview</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-4" id="dashboard-welcome-text">Welcome to your Church Management Dashboard! Here you'll find quick summaries and key metrics.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-6">
                    <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg shadow-sm">
                        <h3 class="text-lg font-medium text-blue-800 dark:text-blue-200" id="total-members-title">Total Members</h3>
                        <p class="text-3xl font-bold text-blue-600 dark:text-blue-400 mt-2" id="total-members-count">0</p>
                    </div>
                    <div class="bg-purple-50 dark:bg-purple-900 p-4 rounded-lg shadow-sm">
                        <h3 class="text-lg font-medium text-purple-800 dark:text-purple-200" id="active-members-title">Active Members</h3>
                        <p class="text-3xl font-bold text-purple-600 dark:text-purple-400 mt-2" id="active-members-count">0</p>
                    </div>
                    <div class="bg-pink-50 dark:bg-pink-900 p-4 rounded-lg shadow-sm">
                        <h3 class="text-lg font-medium text-pink-800 dark:text-pink-200" id="new-believers-title">New Believers</h3>
                        <p class="text-3xl font-bold text-pink-600 dark:text-pink-400 mt-2" id="new-believers-count">0</p>
                    </div>
                    <div class="bg-indigo-50 dark:bg-indigo-900 p-4 rounded-lg shadow-sm">
                        <h3 class="text-lg font-medium text-indigo-800 dark:text-indigo-200" id="service1-members-title">Service 1 Members</h3>
                        <p class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 mt-2" id="service1-members-count">0</p>
                    </div>
                    <div class="bg-teal-50 dark:bg-teal-900 p-4 rounded-lg shadow-sm">
                        <h3 class="text-lg font-medium text-teal-800 dark:text-teal-200" id="service2-members-title">Service 2 Members</h3>
                        <p class="text-3xl font-bold text-teal-600 dark:text-teal-400 mt-2" id="service2-members-count">0</p>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900 p-4 rounded-lg shadow-sm">
                        <h3 class="text-lg font-medium text-green-800 dark:text-green-200" id="upcoming-events-title">Upcoming Events</h3>
                        <p class="text-3xl font-bold text-green-600 dark:text-green-400 mt-2" id="upcoming-events-count">0</p>
                    </div>
                </div>
                <div class="mt-6 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                    <h3 class="text-xl font-semibold mb-2" id="quick-actions-title">Quick Actions</h3>
                    <ul class="list-disc list-inside mt-2 text-gray-700 dark:text-gray-200">
                        <li><button id="add-new-member-dashboard-btn" class="text-indigo-600 dark:text-indigo-400 hover:underline">Add New Member</button></li>
                        <li><button id="create-new-event-dashboard-btn" class="text-indigo-600 dark:text-indigo-400 hover:underline">Create New Event</button></li>
                        <li><button id="add-new-bible-class-dashboard-btn" class="text-indigo-600 dark:text-indigo-400 hover:underline">Add New Bible Class</button></li>
                    </ul>
                </div>
            </section>

            <!-- Bible Class Section -->
            <section id="bible-class-section" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md text-gray-900 dark:text-gray-100 hidden">
                <h2 class="text-2xl font-semibold mb-4" id="bible-class-management-title">Bible Class Management</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-4" id="bible-class-description-text">Manage your Bible classes, track attendance, and organize study materials here.</p>
                
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-4 flex-wrap">
                    <button id="add-new-bible-class-btn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Add New Bible Class</button>
                    <!-- Search for Bible Class -->
                    <div class="flex flex-col sm:flex-row gap-4 items-center">
                        <input type="text" id="bible-class-search-input" placeholder="Search classes..." class="flex-grow p-3 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200 ease-in-out" />
                        <button id="execute-bible-class-search-button" class="px-4 py-2 text-sm bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Search</button>
                    </div>
                </div>

                <div class="mt-6 overflow-x-auto border border-gray-200 dark:border-gray-600 rounded-lg shadow-sm">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="class-title-header">Title</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="class-teacher-header">Teacher</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="class-schedule-header">Schedule</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="class-actions-header">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bible-class-list" class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                            <!-- Bible classes will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Members Section -->
            <section id="members-section" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md text-gray-900 dark:text-gray-100 hidden">
                <h2 class="text-2xl font-semibold mb-4" id="members-list-title">Members List</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-4" id="manage-members-text">Display and manage church members here. Search for members by name or gender.</p>

                <!-- Action buttons: Add New Member, Import, and Export buttons -->
                <div class="flex flex-col sm:flex-row justify-end items-center gap-4 mb-4 flex-wrap">
                    <label for="importExcel" class="flex-1 px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-lg shadow-md hover:bg-gray-300 hover:shadow-lg cursor-pointer text-center dark:bg-gray-600 dark:text-gray-100 dark:hover:bg-gray-500 transition duration-200 ease-in-out">
                        <span id="import-excel-text">Import Excel</span>
                        <input type="file" id="importExcel" accept=".xlsx, .xls" class="hidden" />
                    </label>
                    <button id="export-excel-btn" class="flex-1 px-4 py-2 text-sm bg-green-600 text-white rounded-lg shadow-md hover:bg-green-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Export Excel</button>
                    <button id="add-new-member-btn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Add New Member</button>
                </div>

                <!-- Member controls: Filters, Search -->
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6 flex-wrap">
                    <!-- Left side: Filters -->
                    <div class="flex flex-col sm:flex-row gap-4 items-center">
                        <select id="status-filter-select" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200 ease-in-out">
                            <option value="All">All</option>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                            <option value="Cell group">Cell group</option>
                            <option value="Parth-Way">Parth-Way</option>
                            <option value="New believer">New believer</option>
                            <option value="Visitor">Visitor</option>
                        </select>
                    </div>
                    <!-- Right side: Search -->
                    <div class="flex flex-col sm:flex-row gap-4 items-center">
                        <input type="text" id="member-search-input" placeholder="Search members..." class="flex-grow p-3 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200 ease-in-out" />
                        <button id="execute-search-button" class="px-4 py-2 text-sm bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Search</button>
                    </div>
                </div>

                <div class="overflow-x-auto border border-gray-200 dark:border-gray-600 rounded-lg shadow-sm">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="table-photo-header">Photo</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="table-name-header">Name</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="table-gender-header">Gender</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="table-phone-header">Phone</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="table-baptism-status-header">Baptism Status</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="table-status-header">Status</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="table-actions-header">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="members-table-body" class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                            <!-- Member rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <nav class="mt-4 flex justify-center hidden" aria-label="Pagination" id="members-pagination">
                    <ul class="flex items-center -space-x-px">
                        <li>
                            <button id="prev-page-btn" class="px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Previous</button>
                        </li>
                        <div id="pagination-numbers" class="flex">
                            <!-- Page numbers will be inserted here by JavaScript -->
                        </div>
                        <li>
                            <button id="next-page-btn" class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Next</button>
                        </li>
                    </ul>
                </nav>
            </section>

            <!-- Events Section -->
            <section id="events-section" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md text-gray-900 dark:text-gray-100 hidden">
                <h2 class="text-2xl font-semibold mb-4" id="events-management-title">Events Management</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-4" id="plan-track-events-text">Plan and track church events. This could include calendars, event registration, and attendance tracking.</p>

                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6 flex-wrap">
                    <button id="create-new-event-btn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Create New Event</button>
                    <div class="flex flex-col sm:flex-row gap-4 items-center">
                        <label for="start-date-search" class="text-sm font-medium text-gray-700 dark:text-gray-300" id="start-date-label">Start Date:</label>
                        <input type="date" id="start-date-search" class="p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" />
                        <label for="end-date-search" class="text-sm font-medium text-gray-700 dark:text-gray-300" id="end-date-label">End Date:</label>
                        <input type="date" id="end-date-search" class="p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" />
                        <button id="search-events-by-date-btn" class="px-4 py-2 text-sm bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out">Search by Date</button>
                    </div>
                </div>

                <div class="overflow-x-auto border border-gray-200 dark:border-gray-600 rounded-lg shadow-sm">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-name-header">Event Name</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-date-header">Date</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-time-header">Time</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-location-header">Location</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-service-header">Service</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-team-header">Team</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-description-header">Description</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="event-actions-header">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="events-table-body" class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                            <!-- Event rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports-section" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md text-gray-900 dark:text-gray-100 hidden">
                <h2 class="text-2xl font-semibold mb-4" id="reports-analytics-title">Reports & Analytics</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-4" id="generate-reports-text">Generate reports on membership, attendance, donations, and more.</p>
                <div class="mt-6 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                    <label for="report-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" id="select-report-label">Select a report to generate:</label>
                    <select id="report-select" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">-- Select a report to generate --</option>
                        <option value="Membership Growth Report">Membership Growth Report</option>
                        <option value="Event Attendance Report">Event Attendance Report</option>
                        <option value="Financial Summary Report">Financial Summary Report</option>
                        <option value="Monthly Membership Comparison">Monthly Membership Comparison Report</option>
                    </select>
                    <button id="generate-report-btn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg mt-6 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out" disabled>Generate Report</button>
                </div>
                <div id="generated-report-area" class="mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600 hidden">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4" id="generated-report-title"></h3>
                    <div id="generated-report-content" class="overflow-x-auto">
                        <!-- Report content will be inserted here by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md text-gray-900 dark:text-gray-100 hidden">
                <h2 class="text-2xl font-semibold mb-4" id="settings-title">Settings</h2>
                <div class="mt-6 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                    <h3 class="text-xl font-semibold mb-2" id="language-setting-title">Language</h3>
                    <div class="flex items-center gap-4">
                        <label for="language-select-setting" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="language-label">Language:</label>
                        <select id="language-select-setting" class="mt-1 block w-auto p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="en">English</option>
                            <option value="km">Khmer</option>
                        </select>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-200 dark:bg-gray-900 text-gray-600 dark:text-gray-400 p-4 mt-8 text-center shadow-inner">
        <div class="container mx-auto">
            <p>&copy; 2025 by Sorn Vichea</p>
        </div>
    </footer>

    <!-- Member Modal -->
    <div id="member-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 dark:bg-opacity-75 hidden">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 border-b pb-3 border-gray-200 dark:border-gray-600" id="member-modal-title">Add Member</h3>
            <form id="member-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2 flex flex-col items-center mb-4">
                    <label for="member-photo-upload" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" id="profile-photo-label">Profile Photo</label>
                    <div class="relative w-24 h-24 rounded-full overflow-hidden border-2 border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                        <img id="photo-preview" src="" alt="Profile" class="w-full h-full object-cover max-w-full" />
                        <svg id="photo-placeholder" xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 dark:text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <input type="file" id="member-photo-upload" name="photo" accept="image/*" class="mt-3 text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" />
                </div>

                <div>
                    <label for="member-firstName" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="first-name-label">First Name</label>
                    <input type="text" id="member-firstName" name="firstName" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="member-lastName" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="last-name-label">Last Name</label>
                    <input type="text" id="member-lastName" name="lastName" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="member-gender" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="gender-label">Gender</label>
                    <select id="member-gender" name="gender" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="member-dateOfBirth" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="dob-label">Date of Birth</label>
                    <input type="date" id="member-dateOfBirth" name="dateOfBirth" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="member-memberClass" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="member-class-label">Class</label>
                    <select id="member-memberClass" name="memberClass" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Select Class</option>
                        <option value="Life Guidance Class">Life Guidance Class</option>
                        <option value="Changing Life">Changing Life</option>
                        <option value="Discipleship">Discipleship</option>
                        <option value="Serving Class">Serving Class</option>
                        <option value="SOM">SOM</option>
                        <option value="Leadership">Leadership</option>
                    </select>
                </div>
                <div>
                    <label for="member-baptismStatus" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="baptism-status-label">Baptism Status</label>
                    <select id="member-baptismStatus" name="baptismStatus" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Select Baptism Status</option>
                        <option value="Baptism done">Done</option>
                        <option value="Baptism not yet">Not yet</option>
                    </select>
                </div>
                <div>
                    <label for="member-status" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="member-status-label">Status</label>
                    <select id="member-status" name="status" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Cell group">Cell group</option>
                        <option value="Parth-Way">Parth-Way</option>
                        <option value="New believer">New believer</option>
                        <option value="Visitor">Visitor</option>
                    </select>
                </div>
                <div>
                    <label for="member-from" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="from-label">From (Address/Origin)</label>
                    <input type="text" id="member-from" name="from" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" />
                </div>
                <div>
                    <label for="member-service" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="service-label">Service (e.g., Choir, Usher)</label>
                    <select id="member-service" name="service" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Select Service</option>
                        <option value="Service 1">Service 1</option>
                        <option value="Service 2">Service 2</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="member-phoneNumber" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="phone-number-label">Phone Number</label>
                    <input type="tel" id="member-phoneNumber" name="phoneNumber" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" />
                </div>
                <div>
                    <label for="member-emergencyNumber" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="emergency-number-label">Emergency Number</label>
                    <input type="tel" id="member-emergencyNumber" name="emergencyNumber" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" />
                </div>
                <div>
                    <label for="member-facebook" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="facebook-profile-label">Facebook Profile</label>
                    <input type="text" id="member-facebook" name="facebook" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., facebook.com/yourprofile" />
                </div>
                <div>
                    <label for="member-telegram" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="telegram-id-label">Telegram ID</label>
                    <input type="text" id="member-telegram" name="telegram" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., @yourtelegramid" />
                </div>
                <div class="md:col-span-2">
                    <label for="member-note" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="member-note-label">Note</label>
                    <textarea id="member-note" name="note" rows="3" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                </div>
                <div class="col-span-1 md:col-span-2 flex justify-end space-x-3 mt-4">
                    <button type="button" id="member-modal-cancel-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Cancel</button>
                    <button type="submit" id="member-modal-save-btn" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Member Details Modal -->
    <div id="member-details-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 dark:bg-opacity-75 hidden">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 border-b pb-3 border-gray-200 dark:border-gray-600" id="member-details-modal-title">Member Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="member-details-content">
                <!-- Details populated by JS -->
            </div>
            <div class="flex justify-end mt-6">
                <button id="member-details-close-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Close</button>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 dark:bg-opacity-75 hidden">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 border-b pb-3 border-gray-200 dark:border-gray-600" id="event-modal-title">Add Event</h3>
            <form id="event-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="event-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="event-name-label">Event Name</label>
                    <input type="text" id="event-name" name="name" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="event-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="event-date-label">Date</label>
                    <input type="date" id="event-date" name="date" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="event-time" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="event-time-label">Time</label>
                    <input type="time" id="event-time" name="time" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="event-location" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="event-location-label">Location</label>
                    <select id="event-location" name="location" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required>
                        <option value="">Select Location</option>
                        <option value="Tual Sangkae">Tual Sangkae</option>
                        <option value="Stueng Meanchey">Stueng Meanchey</option>
                        <option value="Main Hall">Main Hall</option>
                        <option value="Youth Room">Youth Room</option>
                        <option value="City Park">City Park</option>
                        <option value="Sanctuary">Sanctuary</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="event-service" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="event-service-label">Service</label>
                    <select id="event-service" name="service" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Select Service</option>
                        <option value="Service 1">Service 1</option>
                        <option value="Service 2">Service 2</option>
                        <option value="Worship">Worship</option>
                        <option value="Youth Ministry">Youth Ministry</option>
                        <option value="Community Service">Community Service</option>
                        <option value="Prayer Ministry">Prayer Ministry</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="event-team" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="event-team-label">Team</label>
                    <select id="event-team" name="team" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Select Team</option>
                        <option value="Dynamic">Dynamic</option>
                        <option value="Static">Static</option>
                        <option value="Pastoral Team">Pastoral Team</option>
                        <option value="Youth Leaders">Youth Leaders</option>
                        <option value="Outreach Team">Outreach Team</option>
                        <option value="Prayer Warriors">Prayer Warriors</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label for="event-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="event-description-label">Description</label>
                    <textarea id="event-description" name="description" rows="3" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                </div>
                <div class="col-span-1 md:col-span-2 flex justify-end space-x-3 mt-4">
                    <button type="button" id="event-modal-cancel-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Cancel</button>
                    <button type="submit" id="event-modal-save-btn" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bible Class Modal -->
    <div id="bible-class-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 dark:bg-opacity-75 hidden">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 border-b pb-3 border-gray-200 dark:border-gray-600" id="bible-class-modal-title">Add Bible Class</h3>
            <form id="bible-class-form" class="grid grid-cols-1 gap-4">
                <div>
                    <label for="bible-class-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="bible-class-title-label">Title</label>
                    <input type="text" id="bible-class-title" name="title" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="bible-class-teacher" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="bible-class-teacher-label">Teacher</label>
                    <input type="text" id="bible-class-teacher" name="teacher" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" required />
                </div>
                <div>
                    <label for="bible-class-schedule" class="block text-sm font-medium text-gray-700 dark:text-gray-300" id="bible-class-schedule-label">Schedule</label>
                    <input type="text" id="bible-class-schedule" name="schedule" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., Every Tuesday, 7:00 PM" required />
                </div>
                <div class="flex justify-end space-x-3 mt-4">
                    <button type="button" id="bible-class-modal-cancel-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Cancel</button>
                    <button type="submit" id="bible-class-modal-save-btn" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Photo Modal -->
    <div id="photo-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-75 hidden">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 max-w-lg max-h-[90vh] overflow-y-auto modal-content">
            <button id="photo-modal-close-btn" class="absolute top-3 right-3 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white text-2xl font-bold focus:outline-none">
                &times;
            </button>
            <img id="photo-modal-image" src="" alt="Enlarged Member Photo" class="max-w-full h-auto rounded-lg" />
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 dark:bg-opacity-75 hidden">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md modal-content">
            <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-4" id="delete-confirm-modal-title">Confirm Deletion</h3>
            <p class="text-gray-700 dark:text-gray-300 mb-6" id="delete-confirmation-text">Are you sure you want to delete this item? This action cannot be undone.</p>
            <div class="flex justify-end space-x-3">
                <button type="button" id="delete-cancel-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Cancel</button>
                <button type="submit" id="delete-confirm-btn" class="px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-200 ease-in-out">Delete</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Global App State
        const appState = {
            activeSection: 'events', // Default active section to 'events' to show calendar
            theme: 'light',
            language: 'en',
            members: [], // This will be populated by local storage
            events: [], // This will be populated by local storage
            bibleClasses: [], // New: This will be populated by local storage
            editingMember: null,
            selectedMember: null,
            memberToDelete: null,
            editingEvent: null,
            eventStartDateFilter: '', // New: for event date filtering
            eventEndDateFilter: '',   // New: for event date filtering
            editingBibleClass: null, // New: for Bible Class editing
            bibleClassToDelete: null, // New: for Bible Class deletion
            memberSearchQuery: '',
            appliedSearchQuery: '',
            bibleClassSearchQuery: '', // New: for Bible Class search
            appliedBibleClassSearchQuery: '', // New: for Bible Class search
            statusFilter: 'All',
            membersPerPage: 10, // Changed to 10 members per page
            currentPage: 1,
            monthlyMembershipData: [
                { month: 'Jan 2025', totalMembers: 150, newMembers: 10, activeMembers: 140 },
                { month: 'Feb 2025', totalMembers: 155, newMembers: 8, activeMembers: 145 },
                { month: 'Mar 2025', totalMembers: 160, newMembers: 12, activeMembers: 150 },
                { month: 'Apr 2025', totalMembers: 162, newMembers: 5, activeMembers: 155 },
                { month: 'May 2025', totalMembers: 168, newMembers: 10, activeMembers: 160 },
                { month: 'Jun 2025', totalMembers: 175, newMembers: 15, activeMembers: 165 },
                { month: 'Jul 2025', totalMembers: 180, newMembers: 10, activeMembers: 170 },
            ],
            translations: {
                en: {
                    dashboard: 'Dashboard',
                    dashboardOverview: 'Dashboard Overview',
                    welcomeDashboard: 'Welcome to your Church Management Dashboard! Here you\'ll find quick summaries and key metrics.',
                    totalMembers: 'Total Members',
                    activeMembers: 'Active Members',
                    newBelievers: 'New Believers',
                    service1Members: 'Service 1 Members',
                    service2Members: 'Service 2 Members',
                    upcomingEvents: 'Upcoming Events',
                    recentDonations: 'Recent Donations',
                    quickActions: 'Quick Actions',
                    addNewMember: 'Add New Member',
                    createNewEvent: 'Create New Event',
                    recordDonation: 'Record Donation',
                    members: 'Members',
                    membersList: 'Members List',
                    manageMembers: 'Display and manage church members here. Search for members by name or gender.',
                    searchMembers: 'Search members...',
                    allStatuses: 'All',
                    active: 'Active',
                    inactive: 'Inactive',
                    serving: 'Serving',
                    cellGroup: 'Cell Group', // Updated
                    parthWay: 'PathWay',     // Updated
                    newBeliever: 'New Believer', // Updated
                    visitor: 'Visitor',
                    done: 'Done', // Changed from Baptism done
                    notYet: 'Not yet', // Changed from Baptism not yet
                    show: 'Show',
                    importExcel: 'Import Excel',
                    exportExcel: 'Export Excel',
                    exportPdf: 'Export as PDF',
                    photo: 'Photo',
                    name: 'Name',
                    gender: 'Gender',
                    phone: 'Phone',
                    status: 'Status',
                    actions: 'Actions',
                    noMembersFound: 'No members found.',
                    previous: 'Previous',
                    next: 'Next',
                    events: 'Events',
                    eventsManagement: 'Events Management',
                    planTrackEvents: 'Plan and track church events. This could include calendars, event registration, and attendance tracking.',
                    upcomingEventsList: 'Upcoming events will be listed here...',
                    sundayService: 'Sunday Service',
                    youthGroupMeeting: 'Youth Group Meeting',
                    communityOutreach: 'Community Outreach',
                    reports: 'Reports',
                    reportsAnalytics: 'Reports & Analytics',
                    selectReport: 'Select a report to generate:',
                    membershipGrowthReport: 'Membership Growth Report',
                    eventAttendanceReport: 'Event Attendance Report', // Added
                    financialSummaryReport: 'Financial Summary Report', // Added
                    monthlyComparisonReport: 'Monthly Membership Comparison Report', // Renamed for consistency
                    generateReportBtn: 'Generate Report', // Added
                    profile: 'Profile',
                    settings: 'Settings',
                    logout: 'Logout',
                    loading: 'Loading...',
                    editMember: 'Edit Member',
                    addMember: 'Add Member',
                    profilePhoto: 'Profile Photo',
                    firstName: 'First Name',
                    lastName: 'Last Name',
                    selectGender: 'Select Gender',
                    dateOfBirth: 'Date of Birth',
                    memberClass: 'Class',
                    selectClassPlaceholder: 'Select Class', // Added
                    fromAddressOrigin: 'From (Address/Origin)',
                    serviceEg: 'Service (e.g., Choir, Usher)',
                    selectService: 'Select Service',
                    phoneNumber: 'Phone Number',
                    emergencyNumber: 'Emergency Number',
                    facebookProfile: 'Facebook Profile',
                    facebookPlaceholder: 'e.g., facebook.com/yourprofile', // Added
                    telegramID: 'Telegram ID',
                    telegramPlaceholder: 'e.g., @yourtelegramid', // Added
                    note: 'Note', // New
                    cancel: 'Cancel',
                    saveChanges: 'Save Changes',
                    memberDetails: 'Member Details',
                    close: 'Close',
                    confirmDeletion: 'Confirm Deletion',
                    deleteConfirmation: 'Are you sure you want to delete {itemName}? This action cannot be undone.', // Dynamic
                    delete: 'Delete',
                    language: 'Language',
                    english: 'English',
                    khmer: 'Khmer',
                    eventName: 'Event Name',
                    eventDate: 'Date',
                    eventTime: 'Time',
                    eventLocation: 'Location',
                    selectLocationPlaceholder: 'Select Location', // Added
                    eventDescription: 'Description',
                    eventService: 'Service',
                    eventTeam: 'Team',
                    selectTeamPlaceholder: 'Select Team', // Added
                    addEvent: 'Add Event',
                    editEvent: 'Edit Event',
                    noEventsFound: 'No events found.',
                    systemName: 'NewLife Fellowship',
                    reportTitleMonthlyComparison: 'Monthly Membership Comparison',
                    reportMonth: 'Month',
                    reportTotalMembers: 'Total Members',
                    reportNewMembers: 'New Members',
                    reportActiveMembers: 'Active Members',
                    search: 'Search',
                    baptismStatus: 'Baptism Status',
                    selectBaptismStatus: 'Select Baptism Status',
                    startDate: 'Start Date', // New
                    endDate: 'End Date',     // New
                    searchByDate: 'Search by Date', // New
                    // Specific options for selects (for dynamic translation)
                    lifeGuidanceClass: 'Life Guidance Class',
                    changingLife: 'Changing Life',
                    discipleship: 'Discipleship',
                    servingClass: 'Serving Class',
                    som: 'SOM',
                    leadership: 'Leadership',
                    service1: 'Service 1',
                    service2: 'Service 2',
                    other: 'Other',
                    tualSangkae: 'Tual Sangkae',
                    stuengMeanchey: 'Stueng Meanchey',
                    mainHall: 'Main Hall',
                    youthRoom: 'Youth Room',
                    cityPark: 'City Park',
                    sanctuary: 'Sanctuary',
                    worship: 'Worship',
                    youthMinistry: 'Youth Ministry',
                    communityService: 'Community Service',
                    prayerMinistry: 'Prayer Ministry',
                    dynamic: 'Dynamic',
                    static: 'Static',
                    pastoralTeam: 'Pastoral Team',
                    youthLeaders: 'Youth Leaders',
                    outreachTeam: 'Outreach Team',
                    prayerWarriors: 'Prayer Warriors',
                    bibleClass: 'Bible Class',
                    bibleClassManagement: 'Bible Class Management',
                    bibleClassDescription: 'Manage your Bible classes, track attendance, and organize study materials here.',
                    upcomingBibleClasses: 'Upcoming Bible Classes',
                    classTitle: 'Title',
                    classTeacher: 'Teacher',
                    classSchedule: 'Schedule',
                    noBibleClassesFound: 'No Bible classes found.',
                    addNewBibleClass: 'Add New Bible Class', // New
                    editBibleClass: 'Edit Bible Class', // New
                    bibleClassSearch: 'Search classes...', // New
                    bibleClassTitle: 'Bible Class Title', // New
                    bibleClassTeacher: 'Bible Class Teacher', // New
                    bibleClassSchedule: 'Bible Class Schedule', // New
                    deleteBibleClassConfirmation: 'Are you sure you want to delete Bible Class {itemName}? This action cannot be undone.', // New
                },
                km: {
                    dashboard: '',
                    dashboardOverview: '',
                    welcomeDashboard: '!  ',
                    totalMembers: '',
                    activeMembers: '',
                    newBelievers: '',
                    service1Members: ' ',
                    service2Members: ' ',
                    upcomingEvents: '',
                    recentDonations: '',
                    quickActions: '',
                    addNewMember: '',
                    createNewEvent: '',
                    recordDonation: '',
                    members: '',
                    membersList: '',
                    manageMembers: '  ',
                    searchMembers: '...',
                    allStatuses: '',
                    active: '',
                    inactive: '',
                    serving: '',
                    cellGroup: '', // Updated
                    parthWay: '', // Updated
                    newBeliever: '', // Updated
                    visitor: '',
                    done: '', // Changed from Baptism done
                    notYet: '', // Changed from Baptism not yet
                    show: '',
                    importExcel: ' Excel',
                    exportExcel: ' Excel',
                    exportPdf: ' PDF',
                    photo: '',
                    name: '',
                    gender: '',
                    phone: '',
                    status: '',
                    actions: '',
                    noMembersFound: '',
                    previous: '',
                    next: '',
                    events: '',
                    eventsManagement: '',
                    planTrackEvents: '    ',
                    upcomingEventsList: '...',
                    sundayService: '',
                    youthGroupMeeting: '',
                    communityOutreach: '',
                    reports: '',
                    reportsAnalytics: ' ',
                    selectReport: '',
                    membershipGrowthReport: '',
                    eventAttendanceReport: '', // Added
                    financialSummaryReport: '', // Added
                    monthlyComparisonReport: '', // Renamed for consistency
                    generateReportBtn: '', // Added
                    profile: '',
                    settings: '',
                    logout: '',
                    loading: '...',
                    editMember: '',
                    addMember: '',
                    profilePhoto: '',
                    firstName: '',
                    lastName: '',
                    selectGender: '',
                    dateOfBirth: '',
                    memberClass: '',
                    selectClassPlaceholder: '', // Added
                    fromAddressOrigin: ' (/)',
                    serviceEg: ' ( , )',
                    selectService: '',
                    phoneNumber: '',
                    emergencyNumber: '',
                    facebookProfile: ' Facebook',
                    facebookPlaceholder: ' facebook.com/yourprofile', // Added
                    telegramID: ' Telegram',
                    telegramPlaceholder: ' @yourtelegramid', // Added
                    note: '', // New
                    cancel: '',
                    saveChanges: '',
                    memberDetails: '',
                    close: '',
                    confirmDeletion: '',
                    deleteConfirmation: ' {itemName} ? ', // Dynamic
                    delete: '',
                    language: '',
                    english: '',
                    khmer: '',
                    eventName: '',
                    eventDate: '',
                    eventTime: '',
                    eventLocation: '',
                    selectLocationPlaceholder: '', // Added
                    eventDescription: '',
                    eventService: '',
                    eventTeam: '',
                    selectTeamPlaceholder: '', // Added
                    addEvent: '',
                    editEvent: '',
                    noEventsFound: '',
                    systemName: 'NewLife Fellowship',
                    reportTitleMonthlyComparison: '',
                    reportMonth: '',
                    reportTotalMembers: '',
                    reportNewMembers: '',
                    reportActiveMembers: '',
                    search: '',
                    baptismStatus: '',
                    selectBaptismStatus: '',
                    startDate: '', // New
                    endDate: '',     // New
                    searchByDate: '', // New
                    // Specific options for selects (for dynamic translation)
                    lifeGuidanceClass: '',
                    changingLife: '',
                    discipleship: '',
                    servingClass: '',
                    som: 'SOM',
                    leadership: '',
                    service1: ' ',
                    service2: ' ',
                    other: '',
                    tualSangkae: '',
                    stuengMeanchey: '',
                    mainHall: '',
                    youthRoom: '',
                    cityPark: '',
                    sanctuary: '',
                    worship: '',
                    youthMinistry: '',
                    communityService: '',
                    prayerMinistry: '',
                    dynamic: '',
                    static: '',
                    pastoralTeam: '',
                    youthLeaders: '',
                    outreachTeam: '',
                    prayerWarriors: '',
                    bibleClass: '',
                    bibleClassManagement: '',
                    bibleClassDescription: '  ',
                    upcomingBibleClasses: '',
                    classTitle: '',
                    classTeacher: '',
                    classSchedule: '',
                    noBibleClassesFound: '',
                    addNewBibleClass: '', // New
                    editBibleClass: '', // New
                    bibleClassSearch: '...', // New
                    bibleClassTitle: '', // New
                    bibleClassTeacher: '', // New
                    bibleClassSchedule: '', // New
                    deleteBibleClassConfirmation: ' {itemName} ? ', // New
                },
            }
        };

        // Utility function to get translated text
        function getTranslation(key) {
            const currentLang = appState.translations[appState.language];
            return currentLang[key] || key; // Fallback to key if translation not found
        }

        // Helper function to capitalize the first letter of a string
        function capitalizeFirstLetter(string) {
            if (!string) return '';
            // Handle multi-word strings by capitalizing each word
            return string.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }

        // --- UI Update Functions ---
        function updateUI() {
            updateHeader();
            updateSidebar();
            renderActiveSection();
            updateModals();
            translateElements();
        }

        function translateElements() {
            const elementsToTranslate = {
                'system-name': 'systemName',
                'profile-text': 'profile',
                'settings-text': 'settings',
                'logout-text': 'logout',
                'dashboard-nav-text': 'dashboard',
                'members-nav-text': 'members',
                'events-nav-text': 'events',
                'reports-nav-text': 'reports',
                'bible-class-nav-text': 'bibleClass',
                'dashboard-overview-title': 'dashboardOverview',
                'dashboard-welcome-text': 'welcomeDashboard',
                'total-members-title': 'totalMembers',
                'active-members-title': 'activeMembers',
                'new-believers-title': 'newBelievers',
                'service1-members-title': 'service1Members',
                'service2-members-title': 'service2Members',
                'upcoming-events-title': 'upcomingEvents',
                'quick-actions-title': 'quickActions',
                'add-new-member-dashboard-btn': 'addNewMember',
                'create-new-event-dashboard-btn': 'createNewEvent',
                'add-new-bible-class-dashboard-btn': 'addNewBibleClass', // New
                'members-list-title': 'membersList',
                'manage-members-text': 'manageMembers',
                // 'member-search-input': 'searchMembers', // Handled separately for placeholder
                'execute-search-button': 'search',
                'import-excel-text': 'importExcel',
                'export-excel-btn': 'exportExcel',
                'table-photo-header': 'photo',
                'table-name-header': 'name',
                'table-gender-header': 'gender',
                'table-phone-header': 'phone',
                'table-baptism-status-header': 'baptismStatus',
                'table-status-header': 'status',
                'table-actions-header': 'actions',
                'prev-page-btn': 'previous',
                'next-page-btn': 'next',
                'events-management-title': 'eventsManagement',
                'plan-track-events-text': 'planTrackEvents',
                'create-new-event-btn': 'createNewEvent',
                'start-date-label': 'startDate', // New
                'end-date-label': 'endDate',     // New
                'search-events-by-date-btn': 'searchByDate', // New
                'event-name-header': 'eventName',
                'event-date-header': 'eventDate',
                'event-time-header': 'eventTime',
                'event-location-header': 'eventLocation',
                'event-service-header': 'eventService',
                'event-team-header': 'eventTeam',
                'event-description-header': 'eventDescription',
                'event-actions-header': 'actions',
                'reports-analytics-title': 'reportsAnalytics',
                // 'generate-reports-text': 'generateReports', // Handled below
                'select-report-label': 'selectReport',
                // 'select-report-placeholder': 'selectReport', // Handled dynamically
                // 'report-membership-growth': 'membershipGrowthReport', // Handled dynamically
                // 'report-event-attendance': 'eventAttendanceReport', // Handled dynamically
                // 'report-financial-summary': 'financialSummaryReport', // Handled dynamically
                // 'report-monthly-comparison': 'monthlyComparisonReport', // Handled dynamically
                'generate-report-btn': 'generateReportBtn', // Handled below
                'profile': 'profile',
                'settings': 'settings',
                'logout': 'logout',
                'loading': 'loading',
                'editMember': 'editMember',
                'addMember': 'addMember',
                'profilePhoto': 'profilePhoto',
                'first-name-label': 'firstName',
                'last-name-label': 'lastName',
                'gender-label': 'gender',
                'select-gender-placeholder': 'selectGender',
                'dob-label': 'dateOfBirth',
                'member-class-label': 'memberClass',
                // 'select-class-placeholder': 'selectClassPlaceholder', // Handled dynamically
                'from-label': 'fromAddressOrigin',
                'service-label': 'serviceEg',
                // 'select-service-placeholder': 'selectService', // Handled dynamically
                'phone-number-label': 'phoneNumber',
                'emergency-number-label': 'emergencyNumber',
                'facebook-profile-label': 'facebookProfile',
                'facebookPlaceholder': 'e.g., facebook.com/yourprofile', // Added
                'telegram-id-label': 'telegramID',
                'telegramPlaceholder': 'e.g., @yourtelegramid', // Added
                'note': 'note', // New
                'cancel': 'cancel',
                'saveChanges': 'saveChanges',
                'memberDetails': 'memberDetails',
                'close': 'close',
                'confirmDeletion': 'confirmDeletion',
                // 'deleteConfirmation': 'deleteConfirmation', // Handled dynamically
                'delete-cancel-btn': 'cancel',
                'delete-confirm-btn': 'delete',
                'language-setting-title': 'language',
                'language-label': 'language',
                // 'lang-en': 'english', // Handled dynamically
                // 'lang-km': 'khmer', // Handled dynamically
                'event-modal-title': 'addEvent',
                'event-modal-save-btn': 'saveChanges',
                'event-name-label': 'eventName',
                'event-date-label': 'eventDate',
                'event-time-label': 'eventTime',
                'event-location-label': 'eventLocation',
                'event-description-label': 'eventDescription',
                'event-service-label': 'eventService',
                'event-team-label': 'eventTeam',
                'event-modal-cancel-btn': 'cancel',
                'report-title-monthly-comparison': 'reportTitleMonthlyComparison',
                'report-month': 'reportMonth',
                'report-total-members': 'reportTotalMembers',
                'report-new-members': 'reportNewMembers',
                'report-active-members': 'reportActiveMembers',
                'search': 'search',
                'baptism-status-label': 'baptismStatus',
                'select-baptism-status-placeholder': 'selectBaptismStatus',
                'member-status-label': 'status',
                // 'status-option-active': 'active', // Handled dynamically
                // 'status-option-inactive': 'inactive', // Handled dynamically
                // 'status-option-cellgroup': 'cellGroup', // Handled dynamically
                // 'status-option-parthway': 'parthWay', // Handled dynamically
                // 'status-option-newbeliever': 'newBeliever', // Handled dynamically
                // 'status-option-visitor': 'visitor', // Handled dynamically
                'baptism-status-display-label': 'baptismStatus',
                'bible-class-management-title': 'bibleClassManagement',
                'bible-class-description-text': 'bibleClassDescription',
                'upcoming-bible-classes-title': 'upcomingBibleClasses',
                'class-title-header': 'classTitle',
                'class-teacher-header': 'classTeacher',
                'class-schedule-header': 'classSchedule',
                'class-actions-header': 'actions', // New
                'noBibleClassesFound': 'noBibleClassesFound',
                'addNewBibleClass': 'addNewBibleClass', // New
                'editBibleClass': 'Edit Bible Class', // New
                'bibleClassSearch': 'Search classes...', // New
                'bibleClassTitle': 'Bible Class Title', // New
                'bibleClassTeacher': 'Bible Class Teacher', // New
                'bibleClassSchedule': 'Bible Class Schedule', // New
                'deleteBibleClassConfirmation': 'Are you sure you want to delete Bible Class {itemName}? This action cannot be undone.', // New
            };

            for (const id in elementsToTranslate) {
                const element = document.getElementById(id);
                if (element) {
                    const translationKey = elementsToTranslate[id];
                    // Skip placeholders here, they are handled below
                    if (element.tagName === 'INPUT' && element.placeholder) {
                        // Do nothing, handled explicitly below
                    } else if (element.tagName === 'OPTION') {
                        // Do nothing, handled explicitly below for select options
                    } else {
                        element.textContent = getTranslation(translationKey);
                    }
                }
            }

            // Handle input placeholders specifically
            const memberSearchInput = document.getElementById('member-search-input');
            if (memberSearchInput) {
                memberSearchInput.placeholder = getTranslation('searchMembers');
            }
            const memberFacebookInput = document.getElementById('member-facebook');
            if (memberFacebookInput) {
                memberFacebookInput.placeholder = getTranslation('facebookPlaceholder');
            }
            const memberTelegramInput = document.getElementById('member-telegram');
            if (memberTelegramInput) {
                memberTelegramInput.placeholder = getTranslation('telegramPlaceholder');
            }
            const bibleClassScheduleInput = document.getElementById('bible-class-schedule'); // New
            if (bibleClassScheduleInput) {
                bibleClassScheduleInput.placeholder = getTranslation('bibleClassSchedule');
            }
            const bibleClassSearchInput = document.getElementById('bible-class-search-input'); // New
            if (bibleClassSearchInput) {
                bibleClassSearchInput.placeholder = getTranslation('bibleClassSearch');
            }

            // Translate status filter select options
            const statusFilterSelect = document.getElementById('status-filter-select');
            if (statusFilterSelect) {
                Array.from(statusFilterSelect.options).forEach(option => {
                    if (option.value === 'All') {
                        option.textContent = getTranslation('allStatuses');
                    } else if (option.value === 'Cell group') { // Specific handling for "Cell group"
                        option.textContent = getTranslation('cellGroup');
                    } else if (option.value === 'Parth-Way') { // Specific handling for "Parth-Way"
                        option.textContent = getTranslation('parthWay');
                    } else if (option.value === 'New believer') { // Specific handling for "New believer"
                        option.textContent = getTranslation('newBeliever');
                    }
                    else {
                        option.textContent = getTranslation(option.value.toLowerCase().replace(/[\s-]/g, ''));
                    }
                });
            }

            // Translate member status select options
            const memberStatusSelect = document.getElementById('member-status');
            if (memberStatusSelect) {
                Array.from(memberStatusSelect.options).forEach(option => {
                    if (option.value === 'Cell group') { // Specific handling for "Cell group"
                        option.textContent = getTranslation('cellGroup');
                    } else if (option.value === 'Parth-Way') { // Specific handling for "Parth-Way"
                        option.textContent = getTranslation('parthWay');
                    } else if (option.value === 'New believer') { // Specific handling for "New believer"
                        option.textContent = getTranslation('newBeliever');
                    }
                    else {
                        option.textContent = getTranslation(option.value.toLowerCase().replace(/[\s-]/g, ''));
                    }
                });
            }

            // Translate baptism status select options
            const baptismStatusSelect = document.getElementById('member-baptismStatus');
            if (baptismStatusSelect) {
                Array.from(baptismStatusSelect.options).forEach(option => {
                    if (option.value === '') {
                        option.textContent = getTranslation('selectBaptismStatus');
                    } else if (option.value === 'Baptism done') {
                        option.textContent = getTranslation('done');
                    } else if (option.value === 'Baptism not yet') {
                        option.textContent = getTranslation('notYet');
                    } else {
                        option.textContent = option.value;
                    }
                });
            }

            // Translate report select options
            const reportSelect = document.getElementById('report-select');
            if (reportSelect) {
                Array.from(reportSelect.options).forEach(option => {
                    if (option.value === '') {
                        option.textContent = getTranslation('selectReport');
                    } else if (option.value === 'Membership Growth Report') {
                        option.textContent = getTranslation('membershipGrowthReport');
                    } else if (option.value === 'Event Attendance Report') {
                        option.textContent = getTranslation('eventAttendanceReport');
                    } else if (option.value === 'Financial Summary Report') {
                        option.textContent = getTranslation('financialSummaryReport');
                    } else if (option.value === 'Monthly Membership Comparison') {
                        option.textContent = getTranslation('monthlyComparisonReport');
                    }
                });
            }
            // Translate the "Generate Report" button separately
            const generateReportBtn = document.getElementById('generate-report-btn');
            if (generateReportBtn) {
                generateReportBtn.textContent = getTranslation('generateReportBtn');
            }

            // Translate member class select options
            const memberClassSelect = document.getElementById('member-memberClass');
            if (memberClassSelect) {
                Array.from(memberClassSelect.options).forEach(option => {
                    if (option.value === '') option.textContent = getTranslation('selectClassPlaceholder');
                    else if (option.value === 'Life Guidance Class') option.textContent = getTranslation('lifeGuidanceClass');
                    else if (option.value === 'Changing Life') option.textContent = getTranslation('changingLife');
                    else if (option.value === 'Discipleship') option.textContent = getTranslation('discipleship');
                    else if (option.value === 'Serving Class') option.textContent = getTranslation('servingClass');
                    else if (option.value === 'SOM') option.textContent = getTranslation('som');
                    else if (option.value === 'Leadership') option.textContent = getTranslation('leadership');
                });
            }

            // Translate member service select options
            const memberServiceSelect = document.getElementById('member-service');
            if (memberServiceSelect) {
                Array.from(memberServiceSelect.options).forEach(option => {
                    if (option.value === '') option.textContent = getTranslation('selectService');
                    else if (option.value === 'Service 1') option.textContent = getTranslation('service1');
                    else if (option.value === 'Service 2') option.textContent = getTranslation('service2');
                    else if (option.value === 'Other') option.textContent = getTranslation('other');
                });
            }

            // Translate event location select options
            const eventLocationSelect = document.getElementById('event-location');
            if (eventLocationSelect) {
                Array.from(eventLocationSelect.options).forEach(option => {
                    if (option.value === '') option.textContent = getTranslation('selectLocationPlaceholder');
                    else if (option.value === 'Tual Sangkae') option.textContent = getTranslation('tualSangkae');
                    else if (option.value === 'Stueng Meanchey') option.textContent = getTranslation('stuengMeanchey');
                    else if (option.value === 'Main Hall') option.textContent = getTranslation('mainHall');
                    else if (option.value === 'Youth Room') option.textContent = getTranslation('youthRoom');
                    else if (option.value === 'City Park') option.textContent = getTranslation('cityPark');
                    else if (option.value === 'Sanctuary') option.textContent = getTranslation('sanctuary');
                    else if (option.value === 'Other') option.textContent = getTranslation('other');
                });
            }

            // Translate event service select options
            const eventServiceSelect = document.getElementById('event-service');
            if (eventServiceSelect) {
                Array.from(eventServiceSelect.options).forEach(option => {
                    if (option.value === '') option.textContent = getTranslation('selectService');
                    else if (option.value === 'Service 1') option.textContent = getTranslation('service1');
                    else if (option.value === 'Service 2') option.textContent = getTranslation('service2');
                    else if (option.value === 'Worship') option.textContent = getTranslation('worship');
                    else if (option.value === 'Youth Ministry') option.textContent = getTranslation('youthMinistry');
                    else if (option.value === 'Community Service') option.textContent = getTranslation('communityService');
                    else if (option.value === 'Prayer Ministry') option.textContent = getTranslation('prayerMinistry');
                    else if (option.value === 'Other') option.textContent = getTranslation('other');
                });
            }

            // Translate event team select options
            const eventTeamSelect = document.getElementById('event-team');
            if (eventTeamSelect) {
                Array.from(eventTeamSelect.options).forEach(option => {
                    if (option.value === '') option.textContent = getTranslation('selectTeamPlaceholder');
                    else if (option.value === 'Dynamic') option.textContent = getTranslation('dynamic');
                    else if (option.value === 'Static') option.textContent = getTranslation('static');
                    else if (option.value === 'Pastoral Team') option.textContent = getTranslation('pastoralTeam');
                    else if (option.value === 'Youth Leaders') option.textContent = getTranslation('youthLeaders');
                    else if (option.value === 'Outreach Team') option.textContent = getTranslation('outreachTeam');
                    else if (option.value === 'Prayer Warriors') option.textContent = getTranslation('prayerWarriors');
                    else if (option.value === 'Other') option.textContent = getTranslation('other');
                });
            }
        }

        function updateHeader() {
            const themeToggleBtn = document.getElementById('theme-toggle');
            if (themeToggleBtn) {
                themeToggleBtn.innerHTML = appState.theme === 'light' ?
                    `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9 9 0 008.354-5.646z" />
                    </svg>` :
                    `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h1M3 12H2m8.003-9.997l-.707-.707M10.707 2.293l.707-.707m-4.003 10.997l-.707.707M3.293 13.293l-.707.707m18.414-1.414l-.707-.707M20.707 10.707l.707-.707m-4.003-10.997l.707-.707M13.293 3.293l.707-.707" />
                    </svg>`;
            }

            const settingsButton = document.getElementById('settings-button');
            if (settingsButton) {
                if (appState.activeSection === 'settings') {
                    settingsButton.classList.add('bg-indigo-600', 'text-white');
                } else {
                    settingsButton.classList.remove('bg-indigo-600', 'text-white');
                }
            }
        }

        function updateSidebar() {
            const navButtons = [
                document.getElementById('nav-dashboard'),
                document.getElementById('nav-bible-class'), // Moved Bible Class here
                document.getElementById('nav-members'),
                document.getElementById('nav-events'),
                document.getElementById('nav-reports')
            ];

            navButtons.forEach(button => {
                const sectionId = button.id.replace('nav-', '');
                if (sectionId === appState.activeSection) {
                    button.classList.add('bg-indigo-100', 'text-indigo-700', 'font-medium', 'dark:bg-indigo-700', 'dark:text-white');
                    button.classList.remove('text-gray-700', 'hover:bg-gray-50', 'dark:text-gray-300', 'dark:hover:bg-gray-700');
                } else {
                    button.classList.remove('bg-indigo-100', 'text-indigo-700', 'font-medium', 'dark:bg-indigo-700', 'dark:text-white');
                    button.classList.add('text-gray-700', 'hover:bg-gray-50', 'dark:text-gray-300', 'dark:hover:bg-gray-700');
                }
            });
        }

        function renderActiveSection() {
            // Updated order to reflect sidebar changes
            const sections = ['dashboard-section', 'bible-class-section', 'members-section', 'events-section', 'reports-section', 'settings-section'];
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    if (sectionId === `${appState.activeSection}-section`) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                }
            });

            switch (appState.activeSection) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'bible-class': // Added new case
                    renderBibleClass();
                    break;
                case 'members':
                    renderMembers();
                    break;
                case 'events':
                    renderEvents();
                    break;
                case 'reports':
                    renderReports();
                    break;
                case 'settings':
                    renderSettings();
                    break;
            }
        }

        function renderDashboard() {
            const totalMembers = appState.members.length;
            const activeMembersCount = appState.members.filter(member => member.status === 'Active').length;
            const newBelieverCount = appState.members.filter(member => member.status === 'New believer').length;
            const service1Count = appState.members.filter(member => member.service === 'Service 1').length;
            const service2Count = appState.members.filter(member => member.service === 'Service 2').length;
            const eventCount = appState.events.length;

            document.getElementById('total-members-count').textContent = totalMembers;
            document.getElementById('active-members-count').textContent = activeMembersCount;
            document.getElementById('new-believers-count').textContent = newBelieverCount;
            document.getElementById('service1-members-count').textContent = service1Count;
            document.getElementById('service2-members-count').textContent = service2Count;
            document.getElementById('upcoming-events-count').textContent = eventCount;
        }

        function renderMembers() {
            const membersTableBody = document.getElementById('members-table-body');
            membersTableBody.innerHTML = ''; // Clear existing rows

            const filteredAndSearchedMembers = appState.members.filter(member => {
                const fullName = `${member.lastName || ''} ${member.firstName || ''}`.trim();
                const matchesSearch = (fullName.toLowerCase().includes(appState.appliedSearchQuery.toLowerCase())) ||
                                      (member.gender && member.gender.toLowerCase().includes(appState.appliedSearchQuery.toLowerCase()));
                const matchesStatus = appState.statusFilter === 'All' || (member.status && member.status === appState.statusFilter);
                return matchesSearch && matchesStatus;
            });

            const totalPages = Math.ceil(filteredAndSearchedMembers.length / appState.membersPerPage);
            const indexOfLastMember = appState.currentPage * appState.membersPerPage;
            const indexOfFirstMember = indexOfLastMember - appState.membersPerPage;
            const currentMembers = filteredAndSearchedMembers.slice(indexOfFirstMember, indexOfLastMember);

            const numberOfColumns = 7; // Photo, Name, Gender, Phone, Baptism Status, Status, Actions
            if (currentMembers.length === 0) {
                membersTableBody.innerHTML = `
                    <tr>
                        <td colspan="${numberOfColumns}" class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                            ${getTranslation('noMembersFound')}
                        </td>
                    </tr>
                `;
            } else {
                currentMembers.forEach(member => {
                    const row = membersTableBody.insertRow();
                    row.className = "hover:bg-gray-50 dark:hover:bg-gray-600 member-row-" + member.id; // Add a unique class for animation targeting

                    const photoCell = row.insertCell();
                    photoCell.className = "px-4 py-3 whitespace-nowrap";
                    photoCell.innerHTML = `
                        <button class="focus:outline-none view-photo-btn" data-photo-url="${member.photo || 'https://placehold.co/400x400/cccccc/ffffff?text=Image+Not+Available'}">
                            ${member.photo ?
                                `<img src="${member.photo}" alt="${member.firstName} ${member.lastName}" class="h-10 w-10 rounded-full object-cover max-w-full" onerror="this.onerror=null;this.src='https://placehold.co/50x50/cccccc/ffffff?text=N/A';" />` :
                                `<div class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-gray-500 dark:text-gray-300 text-xs">No Photo</div>`
                            }
                        </button>
                    `;

                    const nameCell = row.insertCell();
                    nameCell.className = "px-4 py-3 whitespace-nowrap";
                    nameCell.innerHTML = `
                        <button class="text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:underline focus:outline-none view-member-details-btn" data-member-id="${member.id}">
                            ${member.lastName || ''} ${member.firstName || ''}
                        </button>
                    `;

                    const genderCell = row.insertCell();
                    genderCell.className = "px-4 py-3 whitespace-nowrap";
                    genderCell.textContent = member.gender || '';

                    const phoneCell = row.insertCell();
                    phoneCell.className = "px-4 py-3 whitespace-nowrap";
                    phoneCell.textContent = member.phone || '';

                    const baptismStatusCell = row.insertCell();
                    baptismStatusCell.className = "px-4 py-3 whitespace-nowrap";
                    // Use the translation keys 'done' and 'notYet'
                    baptismStatusCell.textContent = member.baptismStatus === 'Baptism done' ? getTranslation('done') :
                                                   (member.baptismStatus === 'Baptism not yet' ? getTranslation('notYet') : member.baptismStatus || '');


                    const statusCell = row.insertCell();
                    statusCell.className = "px-4 py-3 whitespace-nowrap";
                    const statusClass = member.status === 'Active' ? 'bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100' : 'bg-red-100 text-red-800 dark:bg-red-700 dark:text-red-100';
                    statusCell.innerHTML = `
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                            ${capitalizeFirstLetter(getTranslation(member.status?.toLowerCase().replace(/[\s-]/g, '') || '') || member.status || '')}
                        </span>
                    `;

                    const actionsCell = row.insertCell();
                    actionsCell.className = "px-4 py-3 whitespace-nowrap text-sm font-medium flex space-x-2";
                    actionsCell.innerHTML = `
                        <button class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 edit-member-btn transition duration-200 ease-in-out" title="${getTranslation('editMember')}" data-member-id="${member.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.38-2.828-2.828z" />
                            </svg>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 delete-member-btn transition duration-200 ease-in-out" title="${getTranslation('delete')}" data-member-id="${member.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    `;
                });
            }

            const paginationNav = document.getElementById('members-pagination');
            const paginationNumbersDiv = document.getElementById('pagination-numbers');
            if (totalPages > 1) {
                paginationNav.classList.remove('hidden');
                paginationNumbersDiv.innerHTML = '';
                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.textContent = i;
                    pageButton.className = `px-3 py-2 ml-0 leading-tight border border-gray-300 dark:border-gray-700 rounded-md mx-1
                                            ${appState.currentPage === i ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-white'}
                                            focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-200 ease-in-out`;
                    pageButton.addEventListener('click', () => {
                        appState.currentPage = i;
                        renderMembers();
                    });
                    paginationNumbersDiv.appendChild(pageButton);
                }
                document.getElementById('prev-page-btn').disabled = appState.currentPage === 1;
                document.getElementById('prev-page-btn').classList.toggle('opacity-50', appState.currentPage === 1);
                document.getElementById('prev-page-btn').classList.toggle('cursor-not-allowed', appState.currentPage === 1);

                document.getElementById('next-page-btn').disabled = appState.currentPage === totalPages;
                document.getElementById('next-page-btn').classList.toggle('opacity-50', appState.currentPage === totalPages);
                document.getElementById('next-page-btn').classList.toggle('cursor-not-allowed', appState.currentPage === totalPages);

            } else {
                paginationNav.classList.add('hidden');
            }
        }

        function renderEvents() {
            const eventsTableBody = document.getElementById('events-table-body');
            eventsTableBody.innerHTML = ''; // Clear existing rows

            const startDateFilter = appState.eventStartDateFilter;
            const endDateFilter = appState.eventEndDateFilter;

            const filteredEvents = appState.events.filter(event => {
                const eventDate = new Date(event.date);
                let matchesFilter = true;

                if (startDateFilter) {
                    const start = new Date(startDateFilter);
                    matchesFilter = matchesFilter && (eventDate >= start);
                }
                if (endDateFilter) {
                    const end = new Date(endDateFilter);
                    matchesFilter = matchesFilter && (eventDate <= end);
                }
                return matchesFilter;
            });

            if (filteredEvents.length === 0) {
                eventsTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                            ${getTranslation('noEventsFound')}
                        </td>
                    </tr>
                `;
            } else {
                filteredEvents.forEach(event => {
                    const row = eventsTableBody.insertRow();
                    row.className = "hover:bg-gray-50 dark:hover:bg-gray-600";
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">${event.name}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${event.date}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${event.time}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${event.location}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${event.service}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${event.team}</td>
                        <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300 max-w-xs truncate">${event.description}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <button class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 edit-event-btn transition duration-200 ease-in-out" title="${getTranslation('editEvent')}" data-event-id="${event.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.38-2.828-2.828z" />
                                </svg>
                            </button>
                        </td>
                    `;
                });
            }
        }

        function renderReports() {
            const reportSelect = document.getElementById('report-select');
            const generateReportBtn = document.getElementById('generate-report-btn');
            const generatedReportArea = document.getElementById('generated-report-area');
            const generatedReportTitle = document.getElementById('generated-report-title');
            const generatedReportContent = document.getElementById('generated-report-content');

            generateReportBtn.disabled = !reportSelect.value;
            generateReportBtn.classList.toggle('opacity-50', !reportSelect.value);
            generateReportBtn.classList.toggle('cursor-not-allowed', !reportSelect.value);

            if (!reportSelect.value || !appState.generatedReportData) {
                generatedReportArea.classList.add('hidden');
                return;
            }

            generatedReportArea.classList.remove('hidden');
            let selectedReportType = reportSelect.value;

            if (selectedReportType === 'Monthly Membership Comparison') {
                generatedReportTitle.textContent = getTranslation('reportTitleMonthlyComparison');
                let tableHtml = `
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">${getTranslation('reportMonth')}</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">${getTranslation('reportTotalMembers')}</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">${getTranslation('reportNewMembers')}</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">${getTranslation('reportActiveMembers')}</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600">
                `;
                appState.monthlyMembershipData.forEach(data => {
                    tableHtml += `
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-600">
                            <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">${data.month}</td>
                            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${data.totalMembers}</td>
                            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${data.newMembers}</td>
                            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${data.activeMembers}</td>
                        </tr>
                    `;
                });
                tableHtml += `</tbody></table>`;
                generatedReportContent.innerHTML = tableHtml;
            } else {
                generatedReportTitle.textContent = selectedReportType;
                generatedReportContent.innerHTML = `<p class="text-gray-700 dark:text-gray-300">Generating ${selectedReportType} Report... (Not implemented yet)</p>`;
            }
        }

        function renderBibleClass() {
            const bibleClassListBody = document.getElementById('bible-class-list');
            bibleClassListBody.innerHTML = ''; // Clear existing rows

            const filteredAndSearchedClasses = appState.bibleClasses.filter(bClass => {
                const query = appState.appliedBibleClassSearchQuery.toLowerCase();
                return (bClass.title && bClass.title.toLowerCase().includes(query)) ||
                       (bClass.teacher && bClass.teacher.toLowerCase().includes(query));
            });

            if (filteredAndSearchedClasses.length === 0) {
                bibleClassListBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500 dark:text-gray-400">
                            ${getTranslation('noBibleClassesFound')}
                        </td>
                    </tr>
                `;
            } else {
                filteredAndSearchedClasses.forEach(bClass => {
                    const row = bibleClassListBody.insertRow();
                    row.className = "hover:bg-gray-50 dark:hover:bg-gray-600 bible-class-row-" + bClass.id; // Add class for animation
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">${bClass.title}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${bClass.teacher}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">${bClass.schedule}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium flex space-x-2">
                            <button class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 edit-bible-class-btn transition duration-200 ease-in-out" title="${getTranslation('editBibleClass')}" data-class-id="${bClass.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.38-2.828-2.828z" />
                                </svg>
                            </button>
                            <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 delete-bible-class-btn transition duration-200 ease-in-out" title="${getTranslation('delete')}" data-class-id="${bClass.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </td>
                    `;
                });
            }
        }

        function renderSettings() {
            document.getElementById('language-select-setting').value = appState.language;
        }

        // --- Modal Functions ---
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function updateModals() {
            if (document.getElementById('member-modal').classList.contains('hidden')) {
                appState.editingMember = null;
            }
            if (document.getElementById('event-modal').classList.contains('hidden')) {
                appState.editingEvent = null;
            }
            if (document.getElementById('bible-class-modal').classList.contains('hidden')) { // New
                appState.editingBibleClass = null;
            }
            translateElements();
        }

        function populateMemberForm(member) {
            const memberFirstNameInput = document.getElementById('member-firstName');
            const memberLastNameInput = document.getElementById('member-lastName');
            const memberGenderSelect = document.getElementById('member-gender');
            const memberDateOfBirthInput = document.getElementById('member-dateOfBirth');
            const memberMemberClassSelect = document.getElementById('member-memberClass');
            const memberBaptismStatusSelect = document.getElementById('member-baptismStatus');
            const memberStatusSelect = document.getElementById('member-status'); // New: Status select
            const memberFromInput = document.getElementById('member-from');
            const memberServiceSelect = document.getElementById('member-service');
            const memberPhoneNumberInput = document.getElementById('member-phoneNumber');
            const memberEmergencyNumberInput = document.getElementById('member-emergencyNumber');
            const memberFacebookInput = document.getElementById('member-facebook');
            const memberTelegramInput = document.getElementById('member-telegram');
            const memberNoteInput = document.getElementById('member-note'); // New: Note input

            const photoPreview = document.getElementById('photo-preview');
            const photoPlaceholder = document.getElementById('photo-placeholder');

            if (member) {
                document.getElementById('member-modal-title').textContent = getTranslation('editMember');
                document.getElementById('member-modal-save-btn').textContent = getTranslation('saveChanges');

                if (memberFirstNameInput) memberFirstNameInput.value = member.firstName || '';
                if (memberLastNameInput) memberLastNameInput.value = member.lastName || '';
                if (memberGenderSelect) memberGenderSelect.value = member.gender || '';
                if (memberDateOfBirthInput) memberDateOfBirthInput.value = member.dateOfBirth || '';
                if (memberMemberClassSelect) memberMemberClassSelect.value = member.memberClass || '';
                if (memberBaptismStatusSelect) memberBaptismStatusSelect.value = member.baptismStatus || '';
                if (memberStatusSelect) memberStatusSelect.value = member.status || 'Active'; // Set status for existing member
                if (memberFromInput) memberFromInput.value = member.from || '';
                if (memberServiceSelect) memberServiceSelect.value = member.service || '';
                if (memberPhoneNumberInput) memberPhoneNumberInput.value = member.phone || '';
                if (memberEmergencyNumberInput) memberEmergencyNumberInput.value = member.emergencyNumber || '';
                if (memberFacebookInput) memberFacebookInput.value = member.facebook || '';
                if (memberTelegramInput) memberTelegramInput.value = member.telegram || '';
                if (memberNoteInput) memberNoteInput.value = member.note || ''; // New: Set note value

                if (member.photo) {
                    photoPreview.src = member.photo;
                    photoPreview.classList.remove('hidden');
                    photoPlaceholder.classList.add('hidden');
                } else {
                    photoPreview.src = '';
                    photoPreview.classList.add('hidden');
                    photoPlaceholder.classList.remove('hidden');
                }
            } else {
                document.getElementById('member-modal-title').textContent = getTranslation('addMember');
                document.getElementById('member-modal-save-btn').textContent = getTranslation('addMember');
                if (memberFirstNameInput) memberFirstNameInput.value = '';
                if (memberLastNameInput) memberLastNameInput.value = '';
                if (memberGenderSelect) memberGenderSelect.value = '';
                if (memberDateOfBirthInput) memberDateOfBirthInput.value = '';
                if (memberMemberClassSelect) memberMemberClassSelect.value = '';
                if (memberBaptismStatusSelect) memberBaptismStatusSelect.value = '';
                if (memberStatusSelect) memberStatusSelect.value = 'Active'; // Default to Active for new member
                if (memberFromInput) memberFromInput.value = '';
                if (memberServiceSelect) memberServiceSelect.value = '';
                if (memberPhoneNumberInput) memberPhoneNumberInput.value = '';
                if (memberEmergencyNumberInput) memberEmergencyNumberInput.value = '';
                if (memberFacebookInput) memberFacebookInput.value = '';
                if (memberTelegramInput) memberTelegramInput.value = '';
                if (memberNoteInput) memberNoteInput.value = ''; // New: Clear note value

                photoPreview.src = '';
                photoPreview.classList.add('hidden');
                photoPlaceholder.classList.remove('hidden');
            }
        }

        function populateMemberDetails(member) {
            const detailsContent = document.getElementById('member-details-content');
            if (!member) {
                detailsContent.innerHTML = '';
                return;
            }

            let html = '';
            if (member.photo) {
                html += `<div class="md:col-span-2 flex justify-center mb-4">
                            <img src="${member.photo}" alt="Profile" class="h-32 w-32 rounded-full object-cover max-w-full" />
                        </div>`;
            }
            html += `
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('firstName')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.firstName || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('lastName')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.lastName || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('gender')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.gender || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('dateOfBirth')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.dateOfBirth || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('memberClass')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${getTranslation(member.memberClass?.replace(/\s/g, '')?.toLowerCase() || '') || member.memberClass || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('status')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${capitalizeFirstLetter(getTranslation(member.status?.toLowerCase().replace(/[\s-]/g, '') || '') || member.status || '')}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('fromAddressOrigin')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.from || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('serviceEg').split(' ')[0]}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${getTranslation(member.service?.replace(/\s/g, '')?.toLowerCase() || '') || member.service || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('phoneNumber')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.phone || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('emergencyNumber')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.emergencyNumber || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('facebookProfile')}:</p>
                    <p class="mt-1 text-blue-600 dark:text-blue-400 break-words">${member.facebook || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('telegramID')}:</p>
                    <p class="mt-1 text-blue-600 dark:text-blue-400 break-words">${member.telegram || ''}</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300" id="baptism-status-display-label">${getTranslation('baptismStatus')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100">${member.baptismStatus === 'Baptism done' ? getTranslation('done') :
                                                                       (member.baptismStatus === 'Baptism not yet' ? getTranslation('notYet') : member.baptismStatus || '')}</p>
                </div>
                <div class="md:col-span-2">
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${getTranslation('note')}:</p>
                    <p class="mt-1 text-gray-900 dark:text-gray-100 whitespace-pre-wrap">${member.note || ''}</p>
                </div>
            `;
            detailsContent.innerHTML = html;
        }

        function populateEventForm(event) {
            const form = document.getElementById('event-form');
            if (event) {
                document.getElementById('event-modal-title').textContent = getTranslation('editEvent');
                document.getElementById('event-modal-save-btn').textContent = getTranslation('saveChanges');
                form.elements['name'].value = event.name || '';
                form.elements['date'].value = event.date || '';
                form.elements['time'].value = event.time || '';
                form.elements['location'].value = event.location || '';
                form.elements['description'].value = event.description || '';
                form.elements['service'].value = event.service || '';
                form.elements['team'].value = event.team || '';
            } else {
                document.getElementById('event-modal-title').textContent = getTranslation('addEvent');
                document.getElementById('event-modal-save-btn').textContent = getTranslation('addEvent');
                form.reset();
            }
        }

        function populateBibleClassForm(bibleClass) { // New function
            const form = document.getElementById('bible-class-form');
            if (bibleClass) {
                document.getElementById('bible-class-modal-title').textContent = getTranslation('editBibleClass');
                document.getElementById('bible-class-modal-save-btn').textContent = getTranslation('saveChanges');
                form.elements['title'].value = bibleClass.title || '';
                form.elements['teacher'].value = bibleClass.teacher || '';
                form.elements['schedule'].value = bibleClass.schedule || '';
            } else {
                document.getElementById('bible-class-modal-title').textContent = getTranslation('addNewBibleClass');
                document.getElementById('bible-class-modal-save-btn').textContent = getTranslation('addNewBibleClass');
                form.reset();
            }
        }

        // --- Local Storage Functions ---
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }

        function loadData() {
            try {
                const storedMembers = localStorage.getItem('churchMembers');
                const storedEvents = localStorage.getItem('churchEvents');
                const storedBibleClasses = localStorage.getItem('churchBibleClasses'); // Load Bible Classes

                if (storedMembers) {
                    appState.members = JSON.parse(storedMembers);
                } else {
                    appState.members = [
                        {
                            id: generateUniqueId(), firstName: 'John', lastName: 'Doe', gender: 'Male', dateOfBirth: '1990-01-15',
                            memberClass: 'Discipleship', status: 'Active', from: 'Phnom Penh', service: 'Choir',
                            phone: '012345678', emergencyNumber: '098765432', facebook: 'facebook.com/johndoe',
                            telegram: '@johndoe', baptismStatus: 'Baptism done', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=JD', note: 'Regular attendee, active in choir.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Maly', lastName: 'Chan', gender: 'Female', dateOfBirth: '1992-05-20',
                            memberClass: 'Changing Life', status: 'New believer', from: 'Siem Reap', service: 'Usher',
                            phone: '010987654', emergencyNumber: '011234567', facebook: 'facebook.com/malychan',
                            telegram: '@malychan', baptismStatus: 'Baptism not yet', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=MC', note: 'Recently joined, interested in baptism.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Sok', lastName: 'Ly', gender: 'Male', dateOfBirth: '1985-11-01',
                            memberClass: 'Life Guidance Class', status: 'Active', from: 'Battambang', service: 'Service 1',
                            phone: '015123456', emergencyNumber: '016789012', facebook: 'facebook.com/sokly',
                            telegram: '@sokly', baptismStatus: 'Baptism done', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=SL', note: 'Leads a small group.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Dara', lastName: 'Kim', gender: 'Female', dateOfBirth: '1998-03-25',
                            memberClass: 'SOM', status: 'Cell group', from: 'Kandal', service: 'Service 2',
                            phone: '077888999', emergencyNumber: '088777666', facebook: 'facebook.com/darakim',
                            telegram: '@darakim', baptismStatus: 'Baptism done', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=DK', note: 'Active in youth ministry.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Vannak', lastName: 'Chea', gender: 'Male', dateOfBirth: '2000-07-07',
                            memberClass: 'Leadership', status: 'Visitor', from: 'Kampong Cham', service: 'Other',
                            phone: '069111222', emergencyNumber: '096333444', facebook: 'facebook.com/vannakc',
                            telegram: '@vannakc', baptismStatus: 'Baptism not yet', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=VC', note: 'First-time visitor, followed up via Telegram.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Srey', lastName: 'Mom', gender: 'Female', dateOfBirth: '1995-02-10',
                            memberClass: 'Discipleship', status: 'Active', from: 'Pursat', service: 'Choir',
                            phone: '012111222', emergencyNumber: '098111222', facebook: 'facebook.com/sreymom',
                            telegram: '@sreymom', baptismStatus: 'Baptism done', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=SM', note: 'Talented singer, helps with worship.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Chann', lastName: 'Phal', gender: 'Male', dateOfBirth: '1988-09-05',
                            memberClass: 'Life Guidance Class', status: 'Active', from: 'Takeo', service: 'Usher',
                            phone: '010222333', emergencyNumber: '011333444', facebook: 'facebook.com/channphal',
                            telegram: '@channphal', baptismStatus: 'Baptism done', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=CP', note: 'Reliable usher, always on time.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Leakhena', lastName: 'Pov', gender: 'Female', dateOfBirth: '1991-04-22',
                            memberClass: 'Changing Life', status: 'New believer', from: 'Kampong Speu', service: 'Service 1',
                            phone: '015444555', emergencyNumber: '016555666', facebook: 'facebook.com/leakhenapov',
                            telegram: '@leakhenapov', baptismStatus: 'Baptism not yet', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=LP', note: 'Learning about faith, needs mentorship.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Rithy', lastName: 'Sok', gender: 'Male', dateOfBirth: '1979-11-30',
                            memberClass: 'Leadership', status: 'Cell group', from: 'Prey Veng', service: 'Service 2',
                            phone: '077999888', emergencyNumber: '088666555', facebook: 'facebook.com/rithysok',
                            telegram: '@rithysok', baptismStatus: 'Baptism done', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=RS', note: 'Leader of the community outreach team.'
                        },
                        {
                            id: generateUniqueId(), firstName: 'Sovann', lastName: 'Roth', gender: 'Female', dateOfBirth: '2001-08-18',
                            memberClass: 'SOM', status: 'Visitor', from: 'Svay Rieng', service: 'Other',
                            phone: '069777888', emergencyNumber: '096999000', facebook: 'facebook.com/sovannroth',
                            telegram: '@sovannroth', baptismStatus: 'Baptism not yet', photo: 'https://placehold.co/50x50/cccccc/ffffff?text=SR', note: 'Attended once, send follow-up card.'
                        }
                    ];
                    saveData();
                }

                if (storedEvents) {
                    appState.events = JSON.parse(storedEvents);
                } else {
                    appState.events = [
                        {
                            id: generateUniqueId(), name: 'Sunday Service', date: '2025-07-27', time: '09:00', location: 'Main Hall',
                            service: 'Worship', team: 'Pastoral Team', description: 'Weekly Sunday worship service.'
                        },
                        {
                            id: generateUniqueId(), name: 'Youth Group Meeting', date: '2025-07-28', time: '18:00', location: 'Youth Room',
                            service: 'Youth Ministry', team: 'Youth Leaders', description: 'Weekly meeting for youth group members.'
                        },
                        {
                            id: generateUniqueId(), name: 'Community Outreach', date: '2025-08-10', time: '14:00', location: 'City Park',
                            service: 'Community Service', team: 'Outreach Team', description: 'Helping the local community.'
                        },
                        {
                            id: generateUniqueId(), name: 'Prayer Night', date: '2025-08-15', time: '19:00', location: 'Sanctuary',
                            service: 'Prayer Ministry', team: 'Prayer Warriors', description: 'Monthly prayer gathering.'
                        }
                    ];
                    saveData();
                }

                if (storedBibleClasses) {
                    appState.bibleClasses = JSON.parse(storedBibleClasses);
                } else {
                    appState.bibleClasses = [
                        { id: generateUniqueId(), title: 'Foundations of Faith', teacher: 'Pastor John', schedule: 'Every Tuesday, 7:00 PM' },
                        { id: generateUniqueId(), title: 'Book of John Study', teacher: 'Sister Mary', schedule: 'Every Thursday, 8:00 PM' },
                        { id: generateUniqueId(), title: 'Advanced Theology', teacher: 'Brother David', schedule: 'Saturdays, 10:00 AM' },
                    ];
                    saveData();
                }

            } catch (error) {
                console.error("Error loading data from local storage:", error);
                appState.members = [];
                appState.events = [];
                appState.bibleClasses = [];
            }
        }

        function saveData() {
            try {
                localStorage.setItem('churchMembers', JSON.stringify(appState.members));
                localStorage.setItem('churchEvents', JSON.stringify(appState.events));
                localStorage.setItem('churchBibleClasses', JSON.stringify(appState.bibleClasses)); // Save Bible Classes
            } catch (error) {
                console.error("Error saving data to local storage:", error);
            }
        }

        async function addMemberLocal(newMemberData) {
            newMemberData.id = generateUniqueId();
            appState.members.push(newMemberData);
            saveData();
            updateUI();
        }

        async function editMemberLocal(memberId, updatedMemberData) {
            const index = appState.members.findIndex(m => m.id === memberId);
            if (index !== -1) {
                appState.members[index] = { ...appState.members[index], ...updatedMemberData };
                saveData();
                updateUI();
            }
        }

        async function deleteMemberLocal(memberId) {
            appState.members = appState.members.filter(m => m.id !== memberId);
            saveData();
            updateUI();
        }

        async function addEventLocal(newEventData) {
            newEventData.id = generateUniqueId();
            appState.events.push(newEventData);
            saveData();
            updateUI();
        }

        async function editEventLocal(eventId, updatedEventData) {
            const index = appState.events.findIndex(e => e.id === eventId);
            if (index !== -1) {
                appState.events[index] = { ...appState.events[index], ...updatedEventData };
                saveData();
                updateUI();
            }
        }

        async function addBibleClassLocal(newClassData) { // New function
            newClassData.id = generateUniqueId();
            appState.bibleClasses.push(newClassData);
            saveData();
            updateUI();
        }

        async function editBibleClassLocal(classId, updatedClassData) { // New function
            const index = appState.bibleClasses.findIndex(c => c.id === classId);
            if (index !== -1) {
                appState.bibleClasses[index] = { ...appState.bibleClasses[index], ...updatedClassData };
                saveData();
                updateUI();
            }
        }

        async function deleteBibleClassLocal(classId) { // New function
            appState.bibleClasses = appState.bibleClasses.filter(c => c.id !== classId);
            saveData();
            updateUI();
        }

        document.addEventListener('DOMContentLoaded', async () => {
            loadData();
            updateUI();

            const loadScript = (src, id, onloadCallback) => {
                if (!document.getElementById(id)) {
                    const script = document.createElement('script');
                    script.src = src;
                    script.id = id;
                    script.onload = onloadCallback;
                    script.onerror = () => console.error(`Failed to load script: ${src}`);
                    document.head.appendChild(script);
                } else if (onloadCallback) {
                    onloadCallback();
                }
            };
            loadScript('https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js', 'xlsx-script', () => {
                console.log('XLSX loaded');
            });
        });

        document.getElementById('theme-toggle').addEventListener('click', () => {
            appState.theme = appState.theme === 'light' ? 'dark' : 'light';
            document.documentElement.classList.toggle('dark', appState.theme === 'dark');
            document.body.classList.toggle('bg-gray-900', appState.theme === 'dark');
            document.body.classList.toggle('text-gray-100', appState.theme === 'dark');
            document.body.classList.toggle('bg-gray-100', appState.theme === 'light');
            document.body.classList.toggle('text-gray-900', appState.theme === 'light');
            updateHeader();
        });

        document.getElementById('nav-dashboard').addEventListener('click', () => { appState.activeSection = 'dashboard'; updateUI(); });
        document.getElementById('nav-bible-class').addEventListener('click', () => { appState.activeSection = 'bible-class'; updateUI(); }); // Updated order
        document.getElementById('nav-members').addEventListener('click', () => { appState.activeSection = 'members'; updateUI(); });
        document.getElementById('nav-events').addEventListener('click', () => { appState.activeSection = 'events'; updateUI(); });
        document.getElementById('nav-reports').addEventListener('click', () => { appState.activeSection = 'reports'; updateUI(); });
        document.getElementById('settings-button').addEventListener('click', () => { appState.activeSection = 'settings'; updateUI(); });

        document.getElementById('add-new-member-dashboard-btn').addEventListener('click', () => {
            appState.activeSection = 'members';
            appState.editingMember = null;
            updateUI();
            populateMemberForm(null);
            showModal('member-modal');
        });
        document.getElementById('create-new-event-dashboard-btn').addEventListener('click', () => {
            appState.activeSection = 'events';
            appState.editingEvent = null;
            updateUI();
            populateEventForm(null);
            showModal('event-modal');
        });
        document.getElementById('add-new-bible-class-dashboard-btn').addEventListener('click', () => { // New
            appState.activeSection = 'bible-class';
            appState.editingBibleClass = null;
            updateUI();
            populateBibleClassForm(null);
            showModal('bible-class-modal');
        });

        document.getElementById('execute-search-button').addEventListener('click', () => {
            appState.appliedSearchQuery = document.getElementById('member-search-input').value;
            appState.currentPage = 1;
            renderMembers();
        });

        // New event listener for clearing search input
        document.getElementById('member-search-input').addEventListener('input', (e) => {
            if (e.target.value === '') {
                appState.appliedSearchQuery = '';
                appState.currentPage = 1; // Reset to first page
                renderMembers();
            }
        });

        document.getElementById('status-filter-select').addEventListener('change', (e) => {
            appState.statusFilter = e.target.value;
            appState.currentPage = 1;
            renderMembers();
        });
        document.getElementById('add-new-member-btn').addEventListener('click', () => {
            appState.editingMember = null;
            populateMemberForm(null);
            showModal('member-modal');
        });

        document.getElementById('importExcel').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    if (typeof window.XLSX === 'undefined') {
                        console.error("XLSX library not loaded.");
                        console.log("Excel import is not ready. Please try again or refresh the page.");
                        return;
                    }

                    const data = new Uint8Array(e.target.result);
                    const workbook = window.XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = window.XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);

                    for (let row of worksheet) {
                        const newMemberData = {
                            firstName: row['First Name'] || '',
                            lastName: row['Last Name'] || '',
                            gender: row['Gender'] || 'Unknown',
                            dateOfBirth: row['Date of Birth'] || '',
                            memberClass: row['Class'] || '',
                            baptismStatus: row['Baptism Status'] || '',
                            from: row['From'] || '',
                            service: row['Service'] || 'Other',
                            phone: row['Phone Number'] || '',
                            emergencyNumber: row['Emergency Number'] || '',
                            facebook: row['Facebook'] || '',
                            telegram: row['Telegram'] || '',
                            photo: row['Photo'] || '',
                            note: row['Note'] || '', // New: Import note
                        };
                        await addMemberLocal(newMemberData);
                    }
                    console.log('Members imported successfully!');
                } catch (error) {
                    console.error('Error importing Excel file:', error);
                    console.log('Failed to import Excel file. Please ensure it is a valid Excel format and columns match expected headers.');
                }
            };
            reader.readAsArrayBuffer(file);
        });

        document.getElementById('export-excel-btn').addEventListener('click', () => {
            if (typeof window.XLSX === 'undefined') {
                console.error("XLSX library not loaded.");
                console.log("Excel export is not ready. Please try again or refresh the page.");
                return;
            }

            const headers = ["ID", "First Name", "Last Name", "Gender", "Phone", "Baptism Status", "Status", "Service", "Facebook", "Telegram", "Date of Birth", "Class", "From", "Emergency Number", "Photo URL", "Note"]; // Added Note
            const rows = appState.members.map(member => [
                member.id,
                member.firstName,
                member.lastName,
                member.gender,
                member.phone,
                member.baptismStatus,
                member.status,
                member.facebook,
                member.telegram,
                member.dateOfBirth,
                member.memberClass,
                member.from,
                member.emergencyNumber,
                member.photo,
                member.note, // Added Note
            ]);

            const worksheet = window.XLSX.utils.aoa_to_sheet([headers, ...rows]);
            const workbook = window.XLSX.utils.book_new();
            window.XLSX.utils.book_append_sheet(workbook, worksheet, "Members");
            window.XLSX.writeFile(workbook, "church_members.xlsx");
        });

        document.getElementById('prev-page-btn').addEventListener('click', () => {
            appState.currentPage = Math.max(1, appState.currentPage - 1);
            renderMembers();
        });
        document.getElementById('next-page-btn').addEventListener('click', () => {
            const filteredAndSearchedMembers = appState.members.filter(member => {
                const fullName = `${member.lastName || ''} ${member.firstName || ''}`.trim();
                const matchesSearch = (fullName.toLowerCase().includes(appState.appliedSearchQuery.toLowerCase())) ||
                                      (member.gender && member.gender.toLowerCase().includes(appState.appliedSearchQuery.toLowerCase()));
                const matchesStatus = appState.statusFilter === 'All' || (member.status && member.status === appState.statusFilter);
                return matchesSearch && matchesStatus;
            });
            const totalPages = Math.ceil(filteredAndSearchedMembers.length / appState.membersPerPage);
            appState.currentPage = Math.min(totalPages, appState.currentPage + 1);
            renderMembers();
        });

        document.getElementById('members-table-body').addEventListener('click', (e) => {
            if (e.target.closest('.edit-member-btn')) {
                const memberId = e.target.closest('.edit-member-btn').dataset.memberId;
                appState.editingMember = appState.members.find(m => m.id === memberId);
                populateMemberForm(appState.editingMember);
                showModal('member-modal');
            } else if (e.target.closest('.delete-member-btn')) {
                const memberId = e.target.closest('.delete-member-btn').dataset.memberId;
                appState.memberToDelete = appState.members.find(m => m.id === memberId);
                appState.bibleClassToDelete = null; // Ensure only one type of item is marked for deletion
                document.getElementById('delete-confirmation-text').textContent = getTranslation('deleteConfirmation').replace('{itemName}', `${appState.memberToDelete.lastName || ''} ${appState.memberToDelete.firstName || ''}`.trim());
                showModal('delete-confirm-modal');
            } else if (e.target.closest('.view-member-details-btn')) {
                const memberId = e.target.closest('.view-member-details-btn').dataset.memberId;
                appState.selectedMember = appState.members.find(m => m.id === memberId);
                populateMemberDetails(appState.selectedMember);
                showModal('member-details-modal');
            } else if (e.target.closest('.view-photo-btn')) {
                const photoUrl = e.target.closest('.view-photo-btn').dataset.photoUrl;
                document.getElementById('photo-modal-image').src = photoUrl;
                showModal('photo-modal');
            }
        });

        document.getElementById('member-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                firstName: document.getElementById('member-firstName').value,
                lastName: document.getElementById('member-lastName').value,
                gender: document.getElementById('member-gender').value,
                dateOfBirth: document.getElementById('member-dateOfBirth').value,
                memberClass: document.getElementById('member-memberClass').value,
                baptismStatus: document.getElementById('member-baptismStatus').value,
                status: document.getElementById('member-status').value, // Get status from the select element
                from: document.getElementById('member-from').value,
                service: document.getElementById('member-service').value,
                phone: document.getElementById('member-phoneNumber').value,
                emergencyNumber: document.getElementById('member-emergencyNumber').value,
                facebook: document.getElementById('member-facebook').value,
                telegram: document.getElementById('member-telegram').value,
                note: document.getElementById('member-note').value, // New: Get note value
            };

            const photoFile = document.getElementById('member-photo-upload').files[0];
            if (photoFile) {
                const reader = new FileReader();
                reader.onloadend = async () => {
                    formData.photo = reader.result;
                    if (appState.editingMember) {
                        await editMemberLocal(appState.editingMember.id, formData);
                    } else {
                        await addMemberLocal(formData);
                    }
                    hideModal('member-modal');
                };
                reader.readAsDataURL(photoFile);
            } else {
                formData.photo = appState.editingMember ? appState.editingMember.photo : '';
                if (appState.editingMember) {
                    await editMemberLocal(appState.editingMember.id, formData);
                } else {
                    await addMemberLocal(formData);
                }
                hideModal('member-modal');
            }
        });

        document.getElementById('member-modal-cancel-btn').addEventListener('click', () => {
            hideModal('member-modal');
        });

        document.getElementById('member-details-close-btn').addEventListener('click', () => {
            hideModal('member-details-modal');
            appState.selectedMember = null;
        });

        document.getElementById('photo-modal-close-btn').addEventListener('click', () => {
            hideModal('photo-modal');
            document.getElementById('photo-modal-image').src = '';
        });

        document.getElementById('delete-cancel-btn').addEventListener('click', () => {
            hideModal('delete-confirm-modal');
            appState.memberToDelete = null;
            appState.bibleClassToDelete = null;
        });

        // Modified delete confirm button to handle both members and bible classes
        document.getElementById('delete-confirm-btn').addEventListener('click', async () => {
            if (appState.memberToDelete) {
                const memberIdToDelete = appState.memberToDelete.id;
                const rowElement = document.querySelector(`.member-row-${memberIdToDelete}`);

                if (rowElement) {
                    rowElement.classList.add('animate-delete-fire');
                    rowElement.addEventListener('animationend', async function handler() {
                        rowElement.removeEventListener('animationend', handler);
                        await deleteMemberLocal(memberIdToDelete);
                        hideModal('delete-confirm-modal');
                        appState.memberToDelete = null;
                        renderMembers();
                    });
                } else {
                    await deleteMemberLocal(memberIdToDelete);
                    hideModal('delete-confirm-modal');
                    appState.memberToDelete = null;
                    renderMembers();
                }
            } else if (appState.bibleClassToDelete) { // New: Handle Bible Class deletion
                const classIdToDelete = appState.bibleClassToDelete.id;
                const rowElement = document.querySelector(`.bible-class-row-${classIdToDelete}`);

                if (rowElement) {
                    rowElement.classList.add('animate-delete-fire');
                    rowElement.addEventListener('animationend', async function handler() {
                        rowElement.removeEventListener('animationend', handler);
                        await deleteBibleClassLocal(classIdToDelete);
                        hideModal('delete-confirm-modal');
                        appState.bibleClassToDelete = null;
                        renderBibleClass(); // Re-render Bible classes
                    });
                } else {
                    await deleteBibleClassLocal(classIdToDelete);
                    hideModal('delete-confirm-modal');
                    appState.bibleClassToDelete = null;
                    renderBibleClass();
                }
            }
        });

        document.getElementById('create-new-event-btn').addEventListener('click', () => {
            appState.editingEvent = null;
            populateEventForm(null);
            showModal('event-modal');
        });

        // New event listeners for date filtering
        document.getElementById('start-date-search').addEventListener('change', (e) => {
            appState.eventStartDateFilter = e.target.value;
            renderEvents();
        });
        document.getElementById('end-date-search').addEventListener('change', (e) => {
            appState.eventEndDateFilter = e.target.value;
            renderEvents();
        });
        document.getElementById('search-events-by-date-btn').addEventListener('click', () => {
            renderEvents();
        });


        document.getElementById('events-table-body').addEventListener('click', (e) => {
            if (e.target.closest('.edit-event-btn')) {
                const eventId = e.target.closest('.edit-event-btn').dataset.eventId;
                appState.editingEvent = appState.events.find(ev => ev.id === eventId);
                populateEventForm(appState.editingEvent);
                showModal('event-modal');
            }
        });

        document.getElementById('event-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = {
                name: form.elements['name'].value,
                date: form.elements['date'].value,
                time: form.elements['time'].value,
                location: form.elements['location'].value,
                description: form.elements['description'].value,
                service: form.elements['service'].value,
                team: form.elements['team'].value,
            };

            if (appState.editingEvent) {
                await editEventLocal(appState.editingEvent.id, formData);
            } else {
                await addEventLocal(formData);
            }
            hideModal('event-modal');
        });

        document.getElementById('event-modal-cancel-btn').addEventListener('click', () => {
            hideModal('event-modal');
        });

        // New Bible Class Event Listeners
        document.getElementById('add-new-bible-class-btn').addEventListener('click', () => {
            appState.editingBibleClass = null;
            populateBibleClassForm(null);
            showModal('bible-class-modal');
        });

        document.getElementById('bible-class-list').addEventListener('click', (e) => {
            if (e.target.closest('.edit-bible-class-btn')) {
                const classId = e.target.closest('.edit-bible-class-btn').dataset.classId;
                appState.editingBibleClass = appState.bibleClasses.find(c => c.id === classId);
                populateBibleClassForm(appState.editingBibleClass);
                showModal('bible-class-modal');
            } else if (e.target.closest('.delete-bible-class-btn')) {
                const classId = e.target.closest('.delete-bible-class-btn').dataset.classId;
                appState.bibleClassToDelete = appState.bibleClasses.find(c => c.id === classId);
                appState.memberToDelete = null; // Ensure only one type of item is marked for deletion
                document.getElementById('delete-confirmation-text').textContent = getTranslation('deleteBibleClassConfirmation').replace('{itemName}', appState.bibleClassToDelete.title);
                showModal('delete-confirm-modal');
            }
        });

        document.getElementById('bible-class-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = {
                title: form.elements['title'].value,
                teacher: form.elements['teacher'].value,
                schedule: form.elements['schedule'].value,
            };

            if (appState.editingBibleClass) {
                await editBibleClassLocal(appState.editingBibleClass.id, formData);
            } else {
                await addBibleClassLocal(formData);
            }
            hideModal('bible-class-modal');
        });

        document.getElementById('bible-class-modal-cancel-btn').addEventListener('click', () => {
            hideModal('bible-class-modal');
        });

        // Bible Class Search Event Listeners
        document.getElementById('execute-bible-class-search-button').addEventListener('click', () => {
            appState.appliedBibleClassSearchQuery = document.getElementById('bible-class-search-input').value;
            renderBibleClass();
        });

        document.getElementById('bible-class-search-input').addEventListener('input', (e) => {
            if (e.target.value === '') {
                appState.appliedBibleClassSearchQuery = '';
                renderBibleClass();
            }
        });


        document.getElementById('report-select').addEventListener('change', (e) => {
            appState.selectedReportType = e.target.value;
            appState.generatedReportData = null;
            renderReports();
        });
        document.getElementById('generate-report-btn').addEventListener('click', () => {
            let selectedReportType = document.getElementById('report-select').value;
            if (selectedReportType === 'Monthly Membership Comparison') {
                appState.generatedReportData = appState.monthlyMembershipData;
            } else {
                appState.generatedReportData = { message: `Generating ${selectedReportType} Report... (Not implemented yet)` };
            }
            renderReports();
        });

        document.getElementById('language-select-setting').addEventListener('change', (e) => {
            appState.language = e.target.value;
            updateUI();
        });
    </script>
</body>
</html>
